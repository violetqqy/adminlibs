{"version":3,"file":"form-set.component.js","sourceRoot":"","sources":["../../../../lib/dform/component/form-set.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input, Output, EventEmitter, OnInit, AfterViewInit, ChangeDetectorRef, ViewChild } from '@angular/core';\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\nimport { MdDialog, MdDialogRef } from '@angular/material';\n\nimport 'wangeditor/dist/js/wangEditor.js';\nconst Flatpickr = require('flatpickr');\n\nimport { FormBase, FormType } from '../_entity';\nimport { UploadService } from '../_service';\nimport { DialogComponent, DialogOptions } from '../../dmodal';\n\ndeclare var require;\ndeclare var document;\ndeclare var wangEditor;\ndeclare let $: any;\n\n@Component({\n  moduleId: module.id,\n  selector: 'app-form-set',\n  templateUrl: 'form-set.component.html',\n  styleUrls: ['form.component.scss']\n})\nexport class DynamicFormSet implements OnInit, AfterViewInit {\n  @Input() formdata: any;\n  @Input() form: FormGroup;\n  @ViewChild('formSet') formSet: any;\n  @ViewChild('date') date: any;\n  @ViewChild('time') time: any;\n  @ViewChild('datetime') datetime: any;\n\n  formControl = FormType;\n  formValue: any;\n\n  constructor(\n    private cdr: ChangeDetectorRef,\n    private uploadService: UploadService,\n    public dialog: MdDialog\n  ) {}\n\n  ngOnInit() {\n    this.formValue = this.formdata.value;\n    if(this.formdata.controlType === this.formControl.checkbox && this.formdata.options) {\n      this.formValue = [];\n      this.formdata.options.forEach(obj => {\n        if (obj.checked == true) {\n          this.formValue.push(obj.id);\n        }\n      });\n      this.cdr.detectChanges();\n    }\n  }\n\n  ngAfterViewInit() {\n    if(this.date) {\n      new Flatpickr(this.date.nativeElement, {\n        \"locale\": \"zh\",\n        \"defaultDate\": this.formValue || ''\n      });\n      this.cdr.detectChanges();\n    }\n    if(this.time) {\n      new Flatpickr(this.time.nativeElement, {\n        \"locale\": \"zh\",\n        \"enableTime\": true,\n        \"time_24hr\": true,\n        \"noCalendar\": true,\n        \"defaultDate\": this.formValue || ''\n      });\n      this.cdr.detectChanges();\n    }\n    if(this.datetime) {\n      new Flatpickr(this.datetime.nativeElement, {\n        \"locale\": \"zh\",\n        \"enableTime\":true,\n        \"time_24hr\": true,\n        \"defaultDate\": this.formValue || ''\n      });\n      this.cdr.detectChanges();\n    }\n    if (this.formdata.controlType === this.formControl.editor) {\n      this.newEditor(this.formValue);\n    }\n  }\n\n  isValid() {\n    return this.form.controls[this.formdata.key].valid;\n  }\n\n  newEditor(editordata) {\n    let editor = new wangEditor(this.formdata.key);\n    editor.config.menus = MENU;\n    editor.onchange = () => {\n      this.formValue = editor.$txt.html();\n      this.cdr.detectChanges();\n    };\n    editor.create();\n    editor.$txt.html(editordata);\n  }\n\n  getChecked(opt, id){\n    let index = this.formValue.indexOf(id);\n    if(opt.checked) {\n      if(index = -1){\n        this.formValue.push(id);\n      }\n    } else {\n      if(index > -1) {\n        this.formValue.splice(index, 1);\n      }\n    }\n  }\n\n  // 上传图片操作\n  uploadChange(files) {\n    let myForm = new FormData();\n    myForm.append('file', files.target.files[0]);\n\n    this.uploadService.uploadFile(myForm, this.formdata.url, this);\n  }\n\n  UploadSuccess(data) {\n    if (data.code === 0) {\n      this.openDialog('上传图片成功！');\n\n      if (this.formdata.multiple === false) {\n        this.formValue = data.data;\n        this.cdr.detectChanges();\n      } else {\n        if (!this.formValue) {\n          this.formValue = [];\n        }\n        this.formValue.push(data.data);\n        this.cdr.detectChanges();\n      }\n\n    } else {\n      this.openDialog('上传图片失败！');\n    }\n  }\n\n  UploadFailure(data) {\n    this.openDialog('上传图片失败！');\n  }\n\n  fileDel(file ? : any) {\n    if (!file) {\n      this.formValue = '';\n      $('#' + this.formdata.key).val('');\n      this.cdr.detectChanges();\n      this.openDialog('删除照片成功！');\n    } else {\n      let i = this.formValue.indexOf(file);\n      if (i !== -1) {\n        this.formValue.splice(i, 1);\n        this.cdr.detectChanges();\n      }\n      if (this.formValue.length === 0) {\n        this.formValue = null;\n        $('#' + this.formdata.key).val('');\n        this.cdr.detectChanges();\n      }\n      this.openDialog('删除照片成功！');\n    }\n  }\n\n  openDialog(msg) {\n    let option = {\n      data: new DialogOptions(\n        {\n          title: '提示信息',\n          message: msg,\n          buttons: [{\n            key: 'comfirm',\n            value: '确定',\n            color: 'primary'\n          }]\n        }),\n      width: '300px'\n    };\n    let dialogRef = this.dialog.open(DialogComponent, option);\n  }\n\n}\n\nconst MENU = [\n  'source',\n  '|',\n  'bold',\n  'underline',\n  'italic',\n  'strikethrough',\n  'eraser',\n  'forecolor',\n  'bgcolor',\n  '|',\n  'quote',\n  'fontfamily',\n  'fontsize',\n  'head',\n  'unorderlist',\n  'orderlist',\n  'alignleft',\n  'aligncenter',\n  'alignright',\n  '|',\n  'link',\n  'unlink',\n  'table',\n  '|',\n  'img',\n  '|',\n  'undo',\n  'redo',\n  'fullscreen'\n];\n"]}